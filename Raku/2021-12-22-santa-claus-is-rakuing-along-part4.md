第四部分 - 圣诞老人的报告
序言
伴随着《圣诞老人来了》的旋律，一首圣诞小曲唱响了。

他在列一个清单。
他正在仔细检查。
他要查出谁是拉库斯。

圣诞老人正在拉呱。

2021 年圣诞老人行动最新消息

本文第 1 部分报道了圣诞老人员工的新日记程序，以及他们如何保持个人工作日志。第二部分是一个侧面，展示了如何通过使用新的 Zef 模块库来更好地管理圣诞老人的代码。第三部分是另一个侧重点，因为圣诞老人的时间已经不多了。

这篇文章，由你本人，小精灵 Rodney 撰写，将试图展示如何使用 Raku 内置的日期、时间和排序功能，以及处理新日记的类结构的简易性，以使许多过去需要大量时间的报告自动化。他们现在可以快速准备，从而腾出资源来研究更深入观察的问题领域。

报告系统

日志经常被系统范围内的程序（大部分在 Raku 模块 SantaClaus::Utils 中找到）读取和操作，这些程序由 root 运行。单个日志通过提取旧的条目来长期缩短，然后串联到用户主目录中隐藏的.journal.YYY.MM 文件（由 root 拥有，但所有人都可以阅读）。

日志文件中的数据被转换为类实例，目前被部署在两个全局 Raku 哈希中，分别以任务 ID 和用户 ID 为关键。(当 Raku 中新的持久化类型准备就绪时，它们将自然地形成一个大型的磁盘数据库）。

在设计与期刊一起使用的类之前，让我们快速看一下我们希望数据如何被访问和使用。

首先，原始数据给了我们，对于每个用户和他所分配的任务（可能是一个子任务）。

任务的开始时间
处理时间
开始和结束之间的一个或多个报告
任务的结束时间
每个条目的注释

第二，原始数据为我们提供了每个任务和子任务的

最早的开始时间
最晚结束时间
员工在该任务上花费的总时间
从事每项任务的员工名单以及每个人在该任务上花费的时间

到目前为止，我们所收集的数据似乎并没有产生任务/子任务的关系，但这可以通过一个考虑到这一点的任务标识系统来解决。首先，任务标识是一个两字段的数字，第一个字段是任务编号，第二个字段是子任务编号。主管人员通常会使用任务编号，而他们的下属则使用副任务编号。

例如，一个任务号可能是 103458，副任务是 200 和 202。工作的不同员工输入的三个数字将进入。

```
Supervisor: 103458-000
Employee A: 103458-200
Employee B: 103458-202
```

最终的系统可以根据需要进行细化，但目前两级任务标识已经足够。

我们为任务区分了两个类，一个保存所有的任务数据，另一个保存每个日记条目。

一个任务的类看起来像这样。

```raku
class Task {
    has DateTime $.start;
    has DateTime $.end;
    has Duration $.time; # accumulated time in seconds
    has Employee %.workers;
    has Report %.reports;
    # … more attributes

    method hours { $!time / 3600   }
    method days  { self.hours / 24 }
    method weeks { self.days / 7   }
}
```

一个任务日志条目的类看起来像这样。

它应该包含所有影响任务的数据或数据的指针。查询经常以实用的方式使用 Raku Date 和 DateTime 类型的内置功能。

任务 A 何时开始 - $A.start
任务 B 何时结束 - $B.end
Jody 在任务 C 上花了多少个小时？

## 总结

Santa 现在有了一个人员和任务报告系统，它可以自动产生关于当前任务和用于这些任务的人员资源的不断更新的报告。Raku 的内置日期、时间和排序功能有助于减轻 IT 部门在编程和维护系统方面的工作。

注意：在 https://github.com/tbrowder/SantaClaus-Utils 和 https://github.com/tbrowder/SantaClaus-Reports 的 repo 中可以看到本文使用的所有代码。

圣诞老人的尾声

不要忘记 "这个季节的原因"：✝。

正如我总是以查尔斯-狄更斯笔下的小蒂姆的话来结束这些杂记，"愿上帝保佑我们，每一个人！"。[1]"

## 脚注

《圣诞颂歌》是查尔斯-狄更斯（1812-1870）的短篇小说，他是维多利亚时期著名的通俗作家，他的许多作品包括《匹克威克文集》、《奥利弗-斯特》、《大卫-科波菲尔》、《荒凉山庄》、《远大前程》和《双城记》。