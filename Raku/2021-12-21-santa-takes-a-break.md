Part 3 – Santa Takes a Break

序言

伴随着《圣诞老人来了》的旋律，唱出了一首圣诞小曲。

	他在列一个清单。
	他正在仔细检查。
	他要查出谁是拉库的主力。
	圣诞老人正在拉呱。

2021 年圣诞老人行动更新 3

圣诞老人很累。他想按计划吹嘘他的新报告和分析工具，但他知道他必须为即将到来的大日子休息一下（对不起，我的朋友胡安-梅雷洛，让你快速转变！）。

他确信全世界的男孩和女孩都会焦急地等待他的来访，但他也意识到他只是每年在基督教降临节期间庆祝的真正的圣诞礼物的一个替身。他知道将临期第一主日与圣诞节的关系是每年不同的，有点像复活节，复活节需要复杂的算法来计算其实际的日历日期，但更多的是有规律可循，只有一个简单的规则。(实际上，他知道至少有三条规则可以应用，但每条规则都能带来正确的结果）。

他认为，看看 Raku 强大的、内置的 Date 系统如何应用于这个任务会很轻松。

他首先写下了他知道的三条规则。

    找到最接近 11 月 30 日（圣安德鲁节）的主日，无论是之前还是之后。如果 11 月 30 日是一个主日，那就是第一降临节，圣安德鲁就会被转移。
    找到 11 月最后一个星期四之后的主日。
    找到圣诞节前的第四个星期日，不包括可能是圣诞节的那个星期日。

"这些看起来很容易实现，"他心想，"让我们看看我可以做什么，而不需要叫来 IT 部门的专家！"。

"日期对象应该使工作变得足够容易。让我们试试第一种方法。

```raku
my $d = Date.new($y, 11, 30); # Feast of St. Andrew
my $dow = $d.day-of-week;     # 1..7 (Mon..Sun)

# sun mon tue wed thu fri sat sun
# 7 1 2 3 4 5 6 7
# 0 1 2 3 -3 -2 -1 0

if $dow == 7 {
    # bingo!
    return $d
} elsif $dow < 4 {
    # closest to previous Sunday
    return $d – $dow
} else {
    # closest to following Sunday
    return $d + (7 – $dow)
}
```

现在是第二种方法:

```raku
my $d = Date.new($y, 11, 30); # last day of November
my $dow = $d.day-of-week;

while $dow != 4 {
    $d -= 1;
    $dow = $d.day-of-week;
}

# found last Thursday in November
# following Sunday is 3 days hence
$d += 3
```

最后是第三种方法。

```raku
my $d = Date.new($y, 12, 25); # Christmas
my $dow = $d.day-of-week;

if $dow == 7 {
    # Christmas is on Sunday, count 28 days back.
    return $d – 28
} else {
    # find prev Sunday, count 21 days back from that
    # sun mon tue wed thu fri sat sun
    # 7 1 2 3 4 5 6 7
    # 0 1 2 3 -3 -2 -1 0
    return $d – $dow – 21
}
```

"我应该选择哪种方法？他们都能正常工作，因为我知道每一种方法都是针对从几个来源收集的一组数据运行的。我知道，我应该选择哪种方法是最快的，因为它有一天可能会成为日历创建模块的一部分！"。

"如果我真的很认真，我会用拉库的遥测类来运行它们，但我会把这留给专家。但是，我可以做的是在多次迭代中运行每一个，并使用 Raku GNU::Time 模块测量经过的时间，然后比较结果，然后判断最佳。

圣诞老人开始研究速度测试，但很快发现 GNU::Time 的作者并没有给出一个很好的例子来说明如何在这种情况下使用它，而且他也没有时间再做实验了--根据经验，他知道用 Raku 编程是会上瘾的（问问克劳斯太太就知道了！），他不能冒险在圣诞节的约会中迟到。所以他做了第二件最好的事：他向 GNU::Time 提交了一个问题。

他的结论是，由于他不能轻易地确定一个明显的赢家，他将选择方法 3，因为在他看来，这个方法是三个方法中最优雅的，而且是最简单的。毕竟，TIMTOWTDI!

## 总结

Raku 有许多功能，即使是新手程序员也会喜欢它，但对于那些必须关注时间和日期的人来说，它的 Date 和 DateTime 类是圣诞布丁的主角

注意：请参阅新的 Raku 模块 Date::Christian::Advent 和 Date::Easter。两者都使用 App::Mi6 进行管理，并使用新的，也是推荐的 Zef 模块库。

## 圣诞老人的尾声

不要忘记 "这个季节的原因"：✝。

正如我总是用查尔斯-狄更斯笔下的小蒂姆的话来结束这些杂记，"愿上帝保佑我们，每一个人！" [1]

## 脚注

圣诞颂歌》是查尔斯-狄更斯（1812-1870）的短篇小说，他是维多利亚时期著名的通俗作家，他的许多作品包括《匹克威克文集》、《奥利弗-斯特》、《大卫-科波菲尔》、《荒凉山庄》、《远大前程》以及《双城记》。
